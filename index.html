<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,target-densitydpi=high-dpi,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Liar Battleship</title>
    <link href="css/bootstrap.min.css" rel='stylesheet'/>
    <style>
        body {
            bottom: 0;
            left: 0;
            margin: 0;
            padding: 10px;
            position: absolute;
            right: 0;
            top: 0;
        }
        .choose-check-item {
            width:48%;
        }
        .choose-check-item img {
            width: 100%;
        }
        .status-label {
            text-align: center;
            width:100%;
            font-size: 28px;
            display: block;
        }
        .choose-hit-item {
            width: 48%;
            font-size:45px;
        }
        #hit, .result-hit {
            color:red;
        }
        #next-block, #result-checked {
            bottom: 0;
            left: 0;
            position: absolute;
            width: 100%;
        }
        .next-button {
            height: 40px;
            width: 100%;
            margin: 10px 0;
        }
        .input-radar-value, #clear-current-radar-value {
            font-size: 30px;
            height: 50px;
            width: 32%;
            margin: 3px 0;
        }
        .input-radar-value.zero {
            width: 65.5%;
        }
    </style>
  </head>
  <body>
  <div id='select-check-block'>
    <button class='btn btn-default choose-check-item' id='check-adjacent-hit' style='display:inline-block'>
      <img src="img/boom.png"/>
      <label class="status-label">周边攻击</label>
    </button>
    <button class='btn btn-default choose-check-item' id='check-radar' style='display:inline-block'>
      <img src="img/radar.png"/>
      <label class="status-label">雷达扫描</label>
    </button>
  </div>
  <div id='check-adjacent-hit-block' style='display:none'>
    <div>
      <label class="status-label player-number"></label>
      <label class="status-label">请输入Hit或Miss</label>
    </div>
    <div>
      <label id='current-hit-status' class="status-label">?</label>
    </div>
  
    <span>
      <button id='hit' class="btn btn-default choose-hit-item" style='display:inline-block'>Hit!</button>
      <button id='miss' class="btn btn-default choose-hit-item" style='display:inline-block'>Miss!</button>
    </span>
  
  </div>
  <div id='check-radar-block' style='display:none'>
    <div>
      <label class="status-label player-number"></label>
      <label class="status-label">请输入雷达扫描结果</label>
    </div>
    <div>
      <label id='current-radar-value' class="status-label">?</label>
    </div>
    <div>
      <button value='7' class='btn btn-default input-radar-value' style='display:inline-block'>7</button>
      <button value='8' class='btn btn-default input-radar-value' style='display:inline-block'>8</button>
      <button value='9' class='btn btn-default input-radar-value' style='display:inline-block'>9</button>
    </div>
    <div>
      <button value='4' class='btn btn-default input-radar-value' style='display:inline-block'>4</button>
      <button value='5' class='btn btn-default input-radar-value' style='display:inline-block'>5</button>
      <button value='6' class='btn btn-default input-radar-value' style='display:inline-block'>6</button>
    </div>
    <div>
      <button value='1' class='btn btn-default input-radar-value' style='display:inline-block'>1</button>
      <button value='2' class='btn btn-default input-radar-value' style='display:inline-block'>2</button>
      <button value='3' class='btn btn-default input-radar-value' style='display:inline-block'>3</button>
    </div>
    <div>
      <button value='0' class='btn btn-default input-radar-value zero' style='display:inline-block'>0</button>
      <button id='clear-current-radar-value' class="btn btn-default" style='display:inline-block'>C</button>
    </div>
  </div>
  <div id='next-block' style='display:none'>
    <button id='next-player' class="btn btn-primary next-button" style='display:block'>下一位玩家</button>
    <button id='all-done' class="btn btn-danger next-button" style='display:block'>全部输入完毕</button>
  </div>
  <div id="result-block" style="display:none">
      <div>
          <label class="status-label" id="result-label"></label>
      </div>
      <button id='result-checked' class="btn btn-success next-button" style='display:block'>确定</button>
  </div>
  <script src="libs/jquery-3.1.0.min.js"></script>
  <script>
    $(function(){
      var currentRadarValue;
      var totalRadarValue;
      var allHitStatus = false;
      var currentHitStatus;
      var currentCheckType = null;
      var currentPlayerNumber = 1;
      var renderPlayerNumber = function(){
        $(".player-number").text("第"+currentPlayerNumber+"位玩家")
      }
      $("#check-radar").on("click", function() {
        $("#select-check-block").hide();
        $("#check-radar-block").show();
        $("#check-adjacent-hit-block").hide();
        currentCheckType = "radar";
        totalRadarValue = 0;
        currentPlayerNumber = 1;
        renderPlayerNumber();
        clearRadarInput();
      })
      $("#check-adjacent-hit").on("click", function() {
        $("#select-check-block").hide();
        $("#check-adjacent-hit-block").show();
        $("#check-radar-block").hide();
        currentCheckType = "hit";
        currentPlayerNumber = 1;
        allHitStatus = false;
        renderPlayerNumber();
        clearHitInput();
      })
      
      var clearRadarInput = function() {
        currentRadarValue = 0;
        $("#current-radar-value").text("?");
        $("#next-block").hide();
      }
      
      var clearHitInput = function() {
        currentHitStatus = false;
        $("#current-hit-status").text("?");
        $("#next-block").hide();
      }
      
      $("#hit").on("click", function() {
        currentHitStatus = true;
        $("#current-hit-status").text("Hit!");
        $("#next-block").show();
      })
      $("#miss").on("click", function() {
        currentHitStatus = false;
        $("#current-hit-status").text("Miss!");
        $("#next-block").show();
      })
      
      $(".input-radar-value").on("click", function() {
        var value = parseInt($(this).attr("value"));
        if (currentRadarValue === 0) {
          currentRadarValue = value;
        } else {
          currentRadarValue = currentRadarValue * 10 + value;
        }
        $("#current-radar-value").text(currentRadarValue);
        $("#next-block").show();
      })
      
      $("#clear-current-radar-value").on("click", function() {
        clearRadarInput();
      })
      $("#all-done").on("click", function() {
        if (currentCheckType == "radar") {
          totalRadarValue += currentRadarValue;
          $("#result-label").text("扫描到"+totalRadarValue+"点生命").removeClass("result-miss result-hit");
        } else if (currentCheckType == "hit") {
          allHitStatus = allHitStatus || currentHitStatus;
          if ( allHitStatus ) {
              $("#result-label").text("Hit!!").addClass("result-hit").removeClass("result-miss");
          } else {
              $("#result-label").text("Miss!!").addClass("result-miss").removeClass("result-hit");
          }
        }
        $("#select-check-block").hide();
        $("#check-adjacent-hit-block").hide();
        $("#check-radar-block").hide();
        $("#next-block").hide();
        $("#result-block").show();
      })
      $("#next-player").on("click", function() {
        if (currentCheckType == "radar") {
          totalRadarValue += currentRadarValue;
          currentPlayerNumber++;
          renderPlayerNumber();
          clearRadarInput();
        } else if (currentCheckType == "hit") {
          allHitStatus = allHitStatus || currentHitStatus;
          currentPlayerNumber++;
          renderPlayerNumber();
          clearHitInput();
        }
      })
      $("#result-checked").on("click",function(){
        $("#select-check-block").show();
        $("#result-block").hide();
      })
    });
  </script>
  </body>
</html>
